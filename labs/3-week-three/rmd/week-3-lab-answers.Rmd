---
title: "EDS 222: Week 1: In-class Assignment"
author: "{STUDENT NAME}"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Load all the packages needed here
library(tidyverse)
library(readr)
library(gt)

setwd("/Users/fatiq/Dropbox/EDS222_data")

```

# Summarize and describe Categorical data

## Contingency Table:


```{r}
loans <- loans_full_schema %>%
  mutate(application_type = as.character(application_type)) %>%
  filter(application_type != "") %>%
  mutate(
    homeownership    = tolower(homeownership), 
    homeownership    = fct_relevel(homeownership, "rent", "mortgage", "own"), 
    application_type = fct_relevel(application_type, "joint", "individual")
    ) 
loans_individual_rent <- loans %>%
  filter(
    application_type == "individual",
    homeownership    == "rent") %>%
  nrow()

```

## Bar Plots: 


```{r, fig.cap = "Two bar plots: the left panel shows the counts and the right panel shows the proportions of values of the homeownership variable.", fig.asp=0.5}
p_count <- ggplot(loans, aes(x = homeownership)) +
  geom_bar(fill = IMSCOL["green", "full"]) + 
  labs(x = "Homeownership", y = "Count")
p_proportion <- loans %>%
  count(homeownership) %>%
  mutate(proportion = n / sum(n)) %>%
  ggplot(aes(x = homeownership, y = proportion)) +
  geom_col(fill = IMSCOL["green", "full"]) + 
  labs(x = "Homeownership", y = "Proportion")
p_count + p_proportion

```

## Row and Column Proportions: 

```{r}
loans %>%
  count(application_type, homeownership) %>% 
  group_by(application_type) %>%
  mutate(proportion = n / sum(n)) %>% 
  select(-n) %>%
  pivot_wider(names_from = homeownership, values_from = proportion) %>% 
  adorn_totals(where = "col") %>% 
  kbl(linesep = "", booktabs = TRUE, caption = "A contingency table with row proportions for the application type and homeownership variables.") %>%
  kable_styling(bootstrap_options = c("striped", "condensed"), 
                latex_options = c("striped", "hold_position"), full_width = FALSE) %>%
  add_header_above(c(" " = 1, "homeownership" = 3, " " = 1)) %>%
  column_spec(1:5, width = "6em")

```

## Pie Charts: 

```{r}
p_pie <- loans %>% 
  mutate(homeownership = fct_infreq(homeownership)) %>%
  count(homeownership) %>%
  mutate(text_y = cumsum(n) - n/2) %>%
  ggplot(aes(x = "", fill = homeownership, y = n)) + 
  geom_col(position = position_stack(reverse = TRUE), show.legend = FALSE) +
  geom_text_repel(aes(x = 1, label = homeownership, y = text_y)) +
  coord_polar("y", start = 0) +
  scale_fill_openintro("hot") +
  theme_void() +
  labs(title = "Homeownership")
p_bar <- loans %>%
  mutate(homeownership = fct_infreq(homeownership)) %>%
  ggplot(aes(x = homeownership, fill = homeownership)) +
  geom_bar(show.legend = FALSE) +
  scale_fill_openintro("hot") +
  labs(x = "Homeownership", y = "Count")
p_pie + p_bar


```

## Waffle Charts: 


```{r, fig.cap = "Plot A: Waffle chart of homeownership, with levels rent, morgage, and own. Plot B: Waffle chart of loan status, with levels current, fully paid, in grade period, and late.", fig.asp = 0.5, fig.width=8}
p_waffle_homeownership <- loans %>%
  count(homeownership) %>%
  ggplot(aes(fill = homeownership, values = n)) +
  geom_waffle(colour = "white", flip = TRUE, make_proportional = TRUE) +
  labs(fill = NULL, title = "Homeownership") +
  scale_fill_openintro("hot") +
  coord_equal() +
  theme_enhance_waffle() +
  theme(legend.position = "bottom")
p_waffle_loan_status <- loans %>%
  count(loan_status) %>%
  ggplot(aes(fill = loan_status, values = n)) +
  geom_waffle(colour = "white", flip = TRUE, make_proportional = TRUE)  +
  labs(fill = NULL, title = "Loan status") +
  scale_fill_openintro("four") +
  coord_equal() +
  theme_enhance_waffle() +
  theme(legend.position = "bottom") +
  guides(fill=guide_legend(nrow = 2))
p_waffle_homeownership +
  p_waffle_loan_status +
  plot_annotation(tag_levels = "A")
```

## Numerical Data across Charts: 


```{r}
n_county          <- nrow(county)
n_missing_pop2017 <- county %>% 
  filter(is.na(pop2017)) %>% 
  nrow()
n_with_pop_change <- n_county - n_missing_pop2017
county <- county %>%
  mutate(
    pop_change_3levels = case_when(
      pop_change < 0 ~ "loss",
      pop_change == 0 ~ "no change",
      pop_change > 0 ~ "gain"
    ),
    pop_change_2levels = if_else(pop_change_3levels == "gain", "gain", "no gain")
  )
n_pop_no_gain     <- county %>% filter(pop_change_2levels == "no gain") %>% nrow()
n_pop_loss        <- county %>% filter(pop_change_3levels == "loss") %>% nrow()
n_pop_no_change   <- county %>% filter(pop_change_3levels == "no change") %>% nrow()
n_pop_gain        <- county %>% filter(pop_change_3levels == "gain") %>% nrow()


```

## Faceted plots: 


```{r}
p_1 <- county %>%
  filter(!is.na(pop_change) & !is.na(metro)) %>%
  # for better labeling on plot
  rename(
    pop_change_num = pop_change,
    pop_change = pop_change_2levels
    ) %>%
  ggplot(aes(x = median_hh_income, fill = pop_change)) +
  geom_histogram(binwidth = 5000) +
  scale_fill_openintro("two") +
  scale_x_continuous(labels = label_dollar()) +
  facet_grid(pop_change~., labeller = label_both) +
  labs(x = "Median household income", y = NULL) +
  guides(fill = FALSE)
p_2 <- county %>%
  filter(!is.na(pop_change) & !is.na(metro)) %>%
  # for better labeling on plot
  rename(
    pop_change_num = pop_change,
    pop_change = pop_change_2levels
    ) %>%
  ggplot(aes(x = median_hh_income, fill = pop_change)) +
  geom_histogram(binwidth = 5000) +
  scale_fill_openintro("two") +
  scale_x_continuous(labels = label_dollar()) +
  facet_grid(pop_change~metro, labeller = label_both) +
  labs(x = "Median household income", y = NULL) +
  guides(fill = FALSE)
p_1 + p_2 + 
  plot_annotation(tag_levels = "A") + 
  plot_layout(widths = c(1, 2))

```

# Summarize and describe Numerical data

## Summary Statistics, Mean, SD and Outliers

```{r}
# Scatterplot

ggplot(loan50, aes(x = total_income, y = loan_amount)) +
  geom_point(alpha = 0.6, shape = 21, size = 3) +
  labs(x = "Total income", y = "Loan amount") +
  scale_x_continuous(labels = dollar_format(scale = 0.001, suffix = "K")) +
  scale_y_continuous(labels = dollar_format(scale = 0.001, suffix = "K"))


```

## Histograms, Bimodal and Skewness 


```{r}
loan50 %>%
  mutate(interest_rate_cat = cut(interest_rate, breaks = seq(5, 27.5, 2.5))) %>%
  count(interest_rate_cat, name = "Count") %>%
  separate(interest_rate_cat, into = c("lower", "upper"), sep = ",") %>%
  mutate(
    lower = str_remove(lower, "\\("),
    upper = str_remove(upper, "]"),
    lower = paste0(lower, "%"),
    upper = paste0(upper, "%"),
    lower = str_c("(", lower),
    upper = str_c(upper, "]")
  ) %>%
  unite("Interest rate", lower:upper, sep = " - ") %>%
  kbl(linesep = "", booktabs = TRUE, align = "lr", 
      caption = "Counts for the binned interest rate data.") %>%
  kable_styling(bootstrap_options = c("striped", "condensed"), 
                latex_options = c("striped", "hold_position"),
                full_width = FALSE) %>%
  column_spec(1:2, width = "9em")

ggplot(loan50, aes(x = interest_rate)) +
  geom_histogram(breaks = seq(5, 27.5, 2.5)) +
  labs(x = "Interest rate", y = "Count") +
  scale_x_continuous(breaks = seq(5, 25, 5), 
                     labels = label_percent(scale = 1, accuracy = 1))
```

## Box plots, quartiles, and the median


```{r}
p_dotplot <- ggplot(loan50, aes(x = interest_rate)) + 
  geom_dotplot(binwidth = 1, dotsize = 0.7) +
  labs(x = NULL, y = NULL) +
  theme(axis.title.y = element_blank(),
        axis.text.y  = element_blank(),
        axis.ticks.y = element_blank()) +
  scale_x_continuous(labels = label_percent(scale = 1, accuracy = 1),
                     limits = c(0, 30))
p_boxplot <- ggplot(loan50, aes(x = interest_rate)) + 
  geom_boxplot(outlier.size = 2.5) +
  theme(axis.title.y = element_blank(),
        axis.text.y  = element_blank(),
        axis.ticks.y = element_blank()) +
  labs(x = "Interest rate") +
  scale_x_continuous(labels = label_percent(scale = 1, accuracy = 1),
                     limits = c(0, 30))
p_dotplot / 
  p_boxplot +
  plot_annotation(tag_levels = "A") & 
  theme(plot.tag = element_text(size = 10))

```

# Simulation/Proofs to illustrate the Law of Large Numbers

## Result 1: The law of large numbers says that as the sample size increases, the sample average converges towards the expected value. This means that both the sample Mean and standard deviation (SD) approach the true mean and SD as N $\righarrow$ $\infty$. Plot your results in a graph. 

Hint: Generate a distribution, sample from the distribution and take the mean. Repeat this process and each time you repeat an iteration increase the sample size. Use this method to show that the mean of the samples will approach the expected value.

```{r}

# I will use the example of a fair six-side dice which has a true mean of 6.5 for one roll. 
set.seed(1234)
vmean <- numeric(1000)

for (i in 1:1000) {
  vmean[i] <- mean(sample(1:6, i, replace = TRUE))
}
plot(vmean)

```


```{r}

# I will use the example of a fair six-side dice which has a true sd of 1.75 for one roll. 
set.seed(1234)
vsd <- numeric(1000)

for (i in 1:1000) {
  vsd[i] <- sd(sample(1:6, i, replace = TRUE))
}
plot(vsd)

```


## Result 2: The Convergence towards the population mean and SD slows down if the data is noisier. Illustrate this. 
    
    